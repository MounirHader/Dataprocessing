<!DOCTYPE html>

<html>
  <head>
    <title>De Bilt - 2010</title>
  <body>
    <textarea id="rawdata" style="display:none">
    [["2010/01/01", "7"], ["2010/01/02", "12"], ["2010/01/03", "-10"], ["2010/01/04", "-6"], ["2010/01/05", "19"], ["2010/01/06", "-5"], ["2010/01/07", "-21"], ["2010/01/08", "-21"], ["2010/01/09", "-5"], ["2010/01/10", "2"], ["2010/01/11", "0"], ["2010/01/12", "-7"], ["2010/01/13", "-12"], ["2010/01/14", "48"], ["2010/01/15", "18"], ["2010/01/16", "19"], ["2010/01/17", "67"], ["2010/01/18", "53"], ["2010/01/19", "58"], ["2010/01/20", "55"], ["2010/01/21", "38"], ["2010/01/22", "49"], ["2010/01/23", "24"], ["2010/01/24", "6"], ["2010/01/25", "-6"], ["2010/01/26", "-37"], ["2010/01/27", "45"], ["2010/01/28", "52"], ["2010/01/29", "46"], ["2010/01/30", "17"], ["2010/01/31", "37"], ["2010/02/01", "34"], ["2010/02/02", "52"], ["2010/02/03", "62"], ["2010/02/04", "82"], ["2010/02/05", "65"], ["2010/02/06", "57"], ["2010/02/07", "24"], ["2010/02/08", "2"], ["2010/02/09", "-15"], ["2010/02/10", "-12"], ["2010/02/11", "-8"], ["2010/02/12", "9"], ["2010/02/13", "0"], ["2010/02/14", "-13"], ["2010/02/15", "-10"], ["2010/02/16", "17"], ["2010/02/17", "26"], ["2010/02/18", "57"], ["2010/02/19", "53"], ["2010/02/20", "51"], ["2010/02/21", "42"], ["2010/02/22", "83"], ["2010/02/23", "44"], ["2010/02/24", "102"], ["2010/02/25", "110"], ["2010/02/26", "103"], ["2010/02/27", "91"], ["2010/02/28", "109"], ["2010/03/01", "70"], ["2010/03/02", "80"], ["2010/03/03", "71"], ["2010/03/04", "58"], ["2010/03/05", "60"], ["2010/03/06", "32"], ["2010/03/07", "39"], ["2010/03/08", "52"], ["2010/03/09", "56"], ["2010/03/10", "48"], ["2010/03/11", "58"], ["2010/03/12", "68"], ["2010/03/13", "73"], ["2010/03/14", "85"], ["2010/03/15", "92"], ["2010/03/16", "109"], ["2010/03/17", "136"], ["2010/03/18", "173"], ["2010/03/19", "147"], ["2010/03/20", "167"], ["2010/03/21", "123"], ["2010/03/22", "125"], ["2010/03/23", "137"], ["2010/03/24", "179"], ["2010/03/25", "197"], ["2010/03/26", "124"], ["2010/03/27", "127"], ["2010/03/28", "116"], ["2010/03/29", "127"], ["2010/03/30", "138"], ["2010/03/31", "102"], ["2010/04/01", "86"], ["2010/04/02", "136"], ["2010/04/03", "107"], ["2010/04/04", "106"], ["2010/04/05", "109"], ["2010/04/06", "160"], ["2010/04/07", "195"], ["2010/04/08", "133"], ["2010/04/09", "157"], ["2010/04/10", "121"], ["2010/04/11", "103"], ["2010/04/12", "149"], ["2010/04/13", "152"], ["2010/04/14", "154"], ["2010/04/15", "153"], ["2010/04/16", "120"], ["2010/04/17", "166"], ["2010/04/18", "180"], ["2010/04/19", "134"], ["2010/04/20", "125"], ["2010/04/21", "98"], ["2010/04/22", "120"], ["2010/04/23", "148"], ["2010/04/24", "193"], ["2010/04/25", "235"], ["2010/04/26", "168"], ["2010/04/27", "189"], ["2010/04/28", "230"], ["2010/04/29", "252"], ["2010/04/30", "146"], ["2010/05/01", "149"], ["2010/05/02", "87"], ["2010/05/03", "75"], ["2010/05/04", "112"], ["2010/05/05", "132"], ["2010/05/06", "139"], ["2010/05/07", "94"], ["2010/05/08", "109"], ["2010/05/09", "118"], ["2010/05/10", "110"], ["2010/05/11", "115"], ["2010/05/12", "77"], ["2010/05/13", "92"], ["2010/05/14", "128"], ["2010/05/15", "146"], ["2010/05/16", "155"], ["2010/05/17", "159"], ["2010/05/18", "157"], ["2010/05/19", "171"], ["2010/05/20", "207"], ["2010/05/21", "201"], ["2010/05/22", "198"], ["2010/05/23", "237"], ["2010/05/24", "225"], ["2010/05/25", "181"], ["2010/05/26", "130"], ["2010/05/27", "154"], ["2010/05/28", "172"], ["2010/05/29", "210"], ["2010/05/30", "159"], ["2010/05/31", "172"], ["2010/06/01", "185"], ["2010/06/02", "214"], ["2010/06/03", "216"], ["2010/06/04", "233"], ["2010/06/05", "265"], ["2010/06/06", "261"], ["2010/06/07", "188"], ["2010/06/08", "230"], ["2010/06/09", "201"], ["2010/06/10", "217"], ["2010/06/11", "201"], ["2010/06/12", "191"], ["2010/06/13", "166"], ["2010/06/14", "215"], ["2010/06/15", "168"], ["2010/06/16", "220"], ["2010/06/17", "231"], ["2010/06/18", "159"], ["2010/06/19", "157"], ["2010/06/20", "140"], ["2010/06/21", "182"], ["2010/06/22", "209"], ["2010/06/23", "259"], ["2010/06/24", "270"], ["2010/06/25", "246"], ["2010/06/26", "255"], ["2010/06/27", "284"], ["2010/06/28", "298"], ["2010/06/29", "266"], ["2010/06/30", "270"], ["2010/07/01", "284"], ["2010/07/02", "336"], ["2010/07/03", "278"], ["2010/07/04", "258"], ["2010/07/05", "236"], ["2010/07/06", "209"], ["2010/07/07", "257"], ["2010/07/08", "289"], ["2010/07/09", "344"], ["2010/07/10", "327"], ["2010/07/11", "293"], ["2010/07/12", "258"], ["2010/07/13", "265"], ["2010/07/14", "286"], ["2010/07/15", "225"], ["2010/07/16", "241"], ["2010/07/17", "211"], ["2010/07/18", "233"], ["2010/07/19", "275"], ["2010/07/20", "293"], ["2010/07/21", "259"], ["2010/07/22", "235"], ["2010/07/23", "226"], ["2010/07/24", "204"], ["2010/07/25", "198"], ["2010/07/26", "206"], ["2010/07/27", "212"], ["2010/07/28", "223"], ["2010/07/29", "207"], ["2010/07/30", "227"], ["2010/07/31", "215"], ["2010/08/01", "228"], ["2010/08/02", "201"], ["2010/08/03", "221"], ["2010/08/04", "201"], ["2010/08/05", "202"], ["2010/08/06", "233"], ["2010/08/07", "208"], ["2010/08/08", "209"], ["2010/08/09", "223"], ["2010/08/10", "225"], ["2010/08/11", "213"], ["2010/08/12", "203"], ["2010/08/13", "210"], ["2010/08/14", "242"], ["2010/08/15", "202"], ["2010/08/16", "223"], ["2010/08/17", "180"], ["2010/08/18", "199"], ["2010/08/19", "210"], ["2010/08/20", "276"], ["2010/08/21", "259"], ["2010/08/22", "225"], ["2010/08/23", "214"], ["2010/08/24", "199"], ["2010/08/25", "205"], ["2010/08/26", "204"], ["2010/08/27", "172"], ["2010/08/28", "184"], ["2010/08/29", "167"], ["2010/08/30", "179"], ["2010/08/31", "187"], ["2010/09/01", "185"], ["2010/09/02", "177"], ["2010/09/03", "196"], ["2010/09/04", "195"], ["2010/09/05", "197"], ["2010/09/06", "205"], ["2010/09/07", "150"], ["2010/09/08", "210"], ["2010/09/09", "208"], ["2010/09/10", "183"], ["2010/09/11", "233"], ["2010/09/12", "191"], ["2010/09/13", "191"], ["2010/09/14", "167"], ["2010/09/15", "171"], ["2010/09/16", "172"], ["2010/09/17", "150"], ["2010/09/18", "167"], ["2010/09/19", "162"], ["2010/09/20", "181"], ["2010/09/21", "186"], ["2010/09/22", "225"], ["2010/09/23", "208"], ["2010/09/24", "178"], ["2010/09/25", "150"], ["2010/09/26", "144"], ["2010/09/27", "127"], ["2010/09/28", "150"], ["2010/09/29", "142"], ["2010/09/30", "149"], ["2010/10/01", "170"], ["2010/10/02", "182"], ["2010/10/03", "223"], ["2010/10/04", "220"], ["2010/10/05", "195"], ["2010/10/06", "192"], ["2010/10/07", "169"], ["2010/10/08", "163"], ["2010/10/09", "194"], ["2010/10/10", "179"], ["2010/10/11", "162"], ["2010/10/12", "134"], ["2010/10/13", "130"], ["2010/10/14", "125"], ["2010/10/15", "128"], ["2010/10/16", "103"], ["2010/10/17", "107"], ["2010/10/18", "126"], ["2010/10/19", "127"], ["2010/10/20", "93"], ["2010/10/21", "115"], ["2010/10/22", "125"], ["2010/10/23", "86"], ["2010/10/24", "117"], ["2010/10/25", "113"], ["2010/10/26", "101"], ["2010/10/27", "107"], ["2010/10/28", "136"], ["2010/10/29", "131"], ["2010/10/30", "134"], ["2010/10/31", "133"], ["2010/11/01", "92"], ["2010/11/02", "130"], ["2010/11/03", "147"], ["2010/11/04", "159"], ["2010/11/05", "150"], ["2010/11/06", "116"], ["2010/11/07", "82"], ["2010/11/08", "80"], ["2010/11/09", "53"], ["2010/11/10", "85"], ["2010/11/11", "107"], ["2010/11/12", "128"], ["2010/11/13", "115"], ["2010/11/14", "132"], ["2010/11/15", "106"], ["2010/11/16", "60"], ["2010/11/17", "53"], ["2010/11/18", "69"], ["2010/11/19", "87"], ["2010/11/20", "94"], ["2010/11/21", "83"], ["2010/11/22", "63"], ["2010/11/23", "76"], ["2010/11/24", "63"], ["2010/11/25", "48"], ["2010/11/26", "38"], ["2010/11/27", "16"], ["2010/11/28", "5"], ["2010/11/29", "-7"], ["2010/11/30", "-5"], ["2010/12/01", "-37"], ["2010/12/02", "-61"], ["2010/12/03", "-25"], ["2010/12/04", "8"], ["2010/12/05", "47"], ["2010/12/06", "23"], ["2010/12/07", "-13"], ["2010/12/08", "-4"], ["2010/12/09", "54"], ["2010/12/10", "71"], ["2010/12/11", "80"], ["2010/12/12", "68"], ["2010/12/13", "20"], ["2010/12/14", "1"], ["2010/12/15", "36"], ["2010/12/16", "45"], ["2010/12/17", "-6"], ["2010/12/18", "-15"], ["2010/12/19", "-39"], ["2010/12/20", "-47"], ["2010/12/21", "-16"], ["2010/12/22", "-11"], ["2010/12/23", "0"], ["2010/12/24", "-3"], ["2010/12/25", "6"], ["2010/12/26", "48"], ["2010/12/27", "9"], ["2010/12/28", "12"], ["2010/12/29", "18"], ["2010/12/30", "19"], ["2010/12/31", "37"]]
    </textarea>
    <div align="center">
      <h2>De Bilt - 2010</h2>
      <p>De verticale as geeft de maximale temperatuur in graden Celsius aan<br>
        zoals die op de desbetreffende dag is gemeten in De Bilt.</p>
    </div>
    <div class="wrapper" align="center">
      <canvas id="canvas3" class="wrapper" width="1000" height="550" style="border:0px solid #000000;">
      </canvas>
      <canvas id="canvas" class="wrapper" width="1000" height="550" style="border:0px solid #000000;">
      </canvas>
      <div id="date"></div>
      <div id="temp"></div>
    </div>
    <br />
    <span style="color:black" align="center">1 januari 2010 t/m 31 december 2010</span> &nbsp;

    <style>
      canvas {
          position: absolute;
          top: 0;
          left: 0;
      }

      .wrapper {
        position: relative;
        width: 1000px;
        height: 550px;
      }

      .wrapper canvas {
        position: absolute;
        top: 0;
        left: 0;
      }

      #date {
        display: none;
        position: absolute;
        width: 80px;
        height: 20px;
        line-height: 20px;
        color: white;
        background-color: black;

        /* rotate div 90 degrees */
        -ms-transform: rotate(90deg);
        -webkit-transform: rotate(90deg);
        transform: rotate(90deg);
      }

      #temp {
        display: none;
        position: absolute;
        width: 50px;
        color: white;
        background-color: black;
        }
    </style>

    <script type="text/javascript">

      // split raw data in lines
      rawdata = document.getElementById("rawdata").value;
      jsondata = JSON.parse(rawdata);

      // define lists for both dates and temperatures
      datechunks = [];
      tempchunks = [];

      // split off separate chunks for dates and temperatures
      for (i = 0, j = jsondata.length; i < j; i++){
        dateChunk = jsondata[i][0];
        tempChunk = jsondata[i][1];

        // convert to JavaScript dates
        dateChunk = (new Date(dateChunk)).getTime();

        // push chunks to lists
        datechunks.push(dateChunk);
        tempchunks.push(tempChunk);
      }

      // define canvas elements to draw on
      var canvas = document.getElementById("canvas");
      var ctx3 = canvas.getContext("2d");
      ctx3.font = "14pt Helvetica";

      var canvas3 = document.getElementById("canvas3");
      var ctx = canvas3.getContext("2d");
      ctx.font = "14pt Helvetica";

      // get coordinates
      function getCoords(canvas, event) {
          var rect = canvas.getBoundingClientRect();
        return{
          x: event.clientX - rect.left,
          y: event.clientY - rect.top
        };
      }

      // transform function
      function createTransform(domain, range){
    	 var alpha = (range[1] - range[0]) / (domain[1] - domain[0]);
    	 var beta = range[0] - (alpha * domain[0]);

    	return function(x){
    		return alpha * x + beta;
    	 };
      }

      // define transformations
      xtransform = createTransform([1262300400000, 1293750000000], [100, 1000]);
      ytransform = createTransform([-100, 350], [500, 0]);

      // data
      var temp = tempchunks;
      var date = datechunks;

      // draw data
      ctx.beginPath();
      for (i = 0; i < temp.length - 1; i++){
        ctx.moveTo(xtransform(date[i]), ytransform(temp[i]));
        ctx.lineTo(xtransform(date[i + 1]), ytransform(temp[i + 1]));
      }
      ctx.strokeStyle = "rgb(255, 177, 3)"
      ctx.stroke()

      // add eventlistener to empty canvas
      canvas.addEventListener('mousemove', function(evt) {
        // get data point (temperature) at mouse x-coord
        var mousePos = getCoords(canvas, evt);
        index = ((mousePos.x)-100) / 900;
        dag = Math.round(index * 365);
        index2 = ((mousePos.x)-100) / 900;
        dag2 = Math.round(index2 * 365);
        mouse_date = (jsondata[dag2][0])
        mouse_temp = (jsondata[dag][1]);
        // store data in div blocks
        document.getElementById("date").innerHTML = mouse_date;
        document.getElementById("temp").innerHTML = mouse_temp/10 + " &degC";

        // draw circle at right position in graph
        ball_x = mousePos.x;
        ball_y = ytransform(mouse_temp);
        ball_radius = 7;

        ctx3.beginPath();
        ctx3.arc(ball_x,ball_y,ball_radius,0,2*Math.PI);
        ctx3.stroke();

        });

        // declare timeout function
        var drawdivs;

        // when the mouse moves
        canvas.onmousemove = function(){

          // hide div elements
          document.getElementById("temp").style.display = "none";
          document.getElementById("date").style.display = "none";

          // clear timeout function
          clearTimeout(drawdivs);

          // set timeout function
          drawdivs = setTimeout(function(){

            // show div blocks
            document.getElementById("temp").style.display = "block";
            document.getElementById("date").style.display = "block";

            // center temp div relative to residue x axis
            document.getElementById("temp").style.left = ball_x / 2 + 25 + "px";
            document.getElementById("temp").style.top = ball_y + "px";

            // center date div relative to residue y axis
            document.getElementById("date").style.left = ball_x - 30 + "px";
            document.getElementById("date").style.top =  -30 + 40  + ball_y + (500 - ball_y) / 2 + "px";

            // if temperature is low position date div at upper side of ball
            if (mouse_temp < 83){
              document.getElementById("date").style.top = ball_y - 10 - (ball_y/2) + "px";
            }

            // position temp div right from the ball in first months (130 days)
            if (dag2 < 130){
              document.getElementById("temp").style.left = ball_x + (900 - ball_x) / 2 + "px";
            }
          }, 750);

          // empty canvas
          ctx3.clearRect(0,0,canvas.width,canvas.height);

          // draw ball and vertical line
          ctx3.beginPath();
          ctx3.arc(ball_x,ball_y,ball_radius,0,2*Math.PI);
          ctx3.moveTo(ball_x, 0);
          ctx3.lineTo(ball_x, 500);
          ctx3.stroke();

          // draw horizontal line
          ctx3.beginPath();
          ctx3.moveTo(100, ball_y);
          ctx3.lineTo(1000, ball_y);
          ctx3.stroke();
        }

      // x-axis
      ctx.beginPath();
      ctx.strokeStyle = 'black';
      ctx.moveTo(100,500);
      ctx.lineTo(1000,500);
      ctx.stroke();

      // stripes x-axis
      for (i = 0; i < 12; i++){
        ctx.beginPath()
        ctx.moveTo(100+i*75, 495);
        ctx.lineTo(100+i*75, 505);
        ctx.stroke()
      }

      // months for x-axis index
      months = ["    Jan", "    Feb", "  Maa", "   Apr", "   Mei",
      "   Jun", "    Jul", "   Aug", "   Sep",
      "    Okt", "   Nov", "   Dec"];

      for (i = 0; i < 12; i++){
        ctx.fillText(months[i], (105+i*75), 520);
      }

      // line y-axis
      ctx.beginPath();
      ctx.strokeStyle = 'black';
      ctx.moveTo(100,500);
      ctx.lineTo(100,0);
      ctx.stroke();

      // stripes y-axis
      for (i = 0; i < 9; i++){
        ctx.beginPath()
        ctx.moveTo(100, i*(500/9))
        ctx.lineTo(110, i*(500/9))
        ctx.stroke()
      }

      // y-axis temperatures
      ctx.fillText("35", 70, 13)
      ctx.fillText("30", 70, 4+(500/9))
      ctx.fillText("25", 70, 4+(1000/9))
      ctx.fillText("20", 70, 4+(1500/9))
      ctx.fillText("15", 70, 4+(2000/9))
      ctx.fillText("10", 70, 4+(2500/9))
      ctx.fillText("5", 70, 4+(3000/9))
      ctx.fillText("0", 70, 4+(3500/9))
      ctx.fillText("-5", 70, 4+(4000/9))
      ctx.fillText("-10", 65, 4+(4500/9))

      // zero line
      ctx.beginPath();
      ctx.moveTo(100, ytransform(0));
      ctx.lineTo(1000, ytransform(0));
      ctx.setLineDash([10,10])
      ctx.strokeStyle = "green"
      ctx.stroke();
    </script>
  </body>
</html>
